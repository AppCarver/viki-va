# Data Model: LongTermSummary

**1. Data Model Name:** `LongTermSummary`

**2. Purpose / Description:**
A `LongTermSummary` represents a concise, often narrative, overview of one or more past conversations or a specific period of user interaction with the Virtual Assistant. Unlike `LongTermFact` which stores discrete pieces of information, `LongTermSummary` aims to capture the essence, main topics, and flow of discussions. This allows `brain:pre-frontal_cortex` to quickly understand the general context of past interactions, facilitating more natural, context-aware, and personalized follow-up conversations.

Summaries are typically generated by `brain:long_term_mem` using NLP capabilities, condensing raw `ConversationTurn` data.

---

**3. Key Fields / Schema:**

* **`summary_id`** (UUID, **Primary Key**):
    * A unique identifier for this specific `LongTermSummary` record.
* **`user_id`** (UUID, **Indexed**):
    * The unique identifier of the user to whom this summary pertains. Summaries are almost always user-specific.
* **`summary_text`** (String):
    * The generated textual summary of the conversation(s) or interaction period.
    * **Example:** `"User discussed their recent vacation plans, particularly interested in flights to London, and also mentioned their preferred airline is British Airways. They asked about baggage allowance."`
* **`summary_type`** (String / Enum, **Indexed**):
    * Categorization of the summary's scope or purpose.
    * **Examples:**
        * `'CONVERSATION_SUMMARY'` (summary of a single conversation session)
        * `'DAILY_DIGEST'` (summary of all user interactions within a day)
        * `'WEEKLY_REVIEW'`
        * `'TOPIC_SUMMARY'` (summary of all conversations related to a specific topic, e.g., "all car insurance queries")
* **`start_timestamp`** (Datetime):
    * The start time of the conversation period or single conversation covered by this summary.
* **`end_timestamp`** (Datetime):
    * The end time of the conversation period or single conversation covered by this summary.
* **`involved_conversation_ids`** (Array of UUIDs, Optional, **Indexed for lookup**):
    * A list of `conversation_id`s (from `brain:conversationLog`) that contributed to this summary. Useful for drilling down to raw data if needed.
* **`extracted_topics`** (Array of Strings, Optional, **Indexed**):
    * Key topics or keywords automatically identified within the summarized content. Useful for quick filtering or thematic retrieval.
    * **Example:** `["flight booking", "London", "British Airways", "baggage"]`
* **`summary_embedding`** (Vector / Array of Floats, Optional):
    * A high-dimensional vector representation of the `summary_text`. This enables semantic search and retrieval of summaries based on conceptual similarity, even if exact keywords aren't present.
* **`generated_timestamp`** (Datetime):
    * The timestamp when this summary was created by the system.
* **`confidence_score`** (Float, Optional):
    * A score (0.0 to 1.0) indicating the system's confidence in the accuracy and completeness of the generated summary, especially for AI-generated summaries.

---

**4. Relationships to Other Components and Data Models:**

* **Managed by `brain:long_term_mem`:** This component is solely responsible for generating, storing, updating, retrieving, and managing the lifecycle of `LongTermSummary` records.
* **Accessed by `brain:pre-frontal_cortex`:** `brain:pre-frontal_cortex` queries `brain:long_term_mem` for relevant `LongTermSummary` entries to quickly get an overview of a user's past interactions, informing dialogue strategy and personalization.
* **Derived from `ConversationTurn` and `Conversation`:** Summaries are generated by processing the raw text of `ConversationTurn` records and metadata from `Conversation` records, typically leveraging `brain:language_center`'s NLP capabilities for text summarization.
* **Complements `LongTermFact`:** While `LongTermFact` provides structured details, `LongTermSummary` offers broader narrative context, and they are often retrieved together.

---

**5. Lifecycle:**

1.  **Generation:** `LongTermSummary` objects are created by background processes within `brain:long_term_mem` (often triggered after a conversation ends or as part of a batch job), which utilizes advanced NLP techniques to condense conversation history.
2.  **Retrieval:** `brain:pre-frontal_cortex` requests summaries from `brain:long_term_mem` based on `user_id` and potentially `summary_type` or semantic similarity.
3.  **Update/Consolidation:** Multiple small summaries (e.g., individual conversation summaries) can be consolidated into larger summaries (e.g., a daily or weekly digest). This may involve updating existing summaries or creating new ones while deprecating older ones.
4.  **Expiration/Retention:** Retention policies determine how long summaries are kept. They are typically kept much longer than raw turns, but perhaps not indefinitely depending on space and relevance.